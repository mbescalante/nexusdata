"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4909],{2950:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"data-sources/sql","title":"SQL","description":"Configuraci\xf3n y uso de bases de datos SQL como fuentes de datos en NexusData","source":"@site/docs/data-sources/sql.md","sourceDirName":"data-sources","slug":"/data-sources/sql","permalink":"/en/docs/data-sources/sql","draft":false,"unlisted":false,"editUrl":"https://github.com/nexusdata/nexusdata-docs/edit/main/docs/data-sources/sql.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"SQL","description":"Configuraci\xf3n y uso de bases de datos SQL como fuentes de datos en NexusData"},"sidebar":"tutorialSidebar","previous":{"title":"Fuentes de Datos","permalink":"/en/docs/data-sources/"},"next":{"title":"NoSQL","permalink":"/en/docs/data-sources/nosql"}}');var s=r(4848),i=r(8453);const o={sidebar_position:2,title:"SQL",description:"Configuraci\xf3n y uso de bases de datos SQL como fuentes de datos en NexusData"},t="SQL",c={},d=[{value:"Bases de Datos Soportadas",id:"bases-de-datos-soportadas",level:2},{value:"Configuraci\xf3n de Conexi\xf3n",id:"configuraci\xf3n-de-conexi\xf3n",level:2},{value:"Configuraci\xf3n B\xe1sica",id:"configuraci\xf3n-b\xe1sica",level:3},{value:"Opciones Avanzadas",id:"opciones-avanzadas",level:3},{value:"PostgreSQL",id:"postgresql",level:4},{value:"MySQL/MariaDB",id:"mysqlmariadb",level:4},{value:"SQL Server",id:"sql-server",level:4},{value:"Oracle",id:"oracle",level:4},{value:"Conexi\xf3n mediante URL",id:"conexi\xf3n-mediante-url",level:3},{value:"Variables de Entorno",id:"variables-de-entorno",level:3},{value:"Configuraci\xf3n de Modelos",id:"configuraci\xf3n-de-modelos",level:2},{value:"Mapeo de Tablas",id:"mapeo-de-tablas",level:3},{value:"\xcdndices",id:"\xedndices",level:3},{value:"Relaciones",id:"relaciones",level:3},{value:"Sincronizaci\xf3n de Esquema",id:"sincronizaci\xf3n-de-esquema",level:2},{value:"Opciones de Sincronizaci\xf3n",id:"opciones-de-sincronizaci\xf3n",level:3},{value:"Migraciones",id:"migraciones",level:2},{value:"Crear una Migraci\xf3n",id:"crear-una-migraci\xf3n",level:3},{value:"Ejecutar Migraciones",id:"ejecutar-migraciones",level:3},{value:"Consultas Personalizadas",id:"consultas-personalizadas",level:2},{value:"Consultas SQL Directas",id:"consultas-sql-directas",level:3},{value:"Consultas con QueryBuilder",id:"consultas-con-querybuilder",level:3},{value:"Transacciones",id:"transacciones",level:2},{value:"Procedimientos Almacenados y Funciones",id:"procedimientos-almacenados-y-funciones",level:2},{value:"Optimizaci\xf3n de Rendimiento",id:"optimizaci\xf3n-de-rendimiento",level:2},{value:"Configuraci\xf3n de Pool de Conexiones",id:"configuraci\xf3n-de-pool-de-conexiones",level:3},{value:"Consultas Optimizadas",id:"consultas-optimizadas",level:3},{value:"Monitoreo y Diagn\xf3stico",id:"monitoreo-y-diagn\xf3stico",level:2},{value:"Logging de Consultas",id:"logging-de-consultas",level:3},{value:"Estad\xedsticas de Conexi\xf3n",id:"estad\xedsticas-de-conexi\xf3n",level:3},{value:"Mejores Pr\xe1cticas",id:"mejores-pr\xe1cticas",level:2},{value:"Soluci\xf3n de Problemas Comunes",id:"soluci\xf3n-de-problemas-comunes",level:2},{value:"Problemas de Conexi\xf3n",id:"problemas-de-conexi\xf3n",level:3},{value:"Problemas de Rendimiento",id:"problemas-de-rendimiento",level:3},{value:"Conclusi\xf3n",id:"conclusi\xf3n",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"sql",children:"SQL"})}),"\n",(0,s.jsx)(n.p,{children:"NexusData proporciona soporte robusto para bases de datos SQL, permiti\xe9ndote conectar y trabajar con diversos sistemas de gesti\xf3n de bases de datos relacionales."}),"\n",(0,s.jsx)(n.h2,{id:"bases-de-datos-soportadas",children:"Bases de Datos Soportadas"}),"\n",(0,s.jsx)(n.p,{children:"NexusData soporta las siguientes bases de datos SQL:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL"})," (9.6+)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"MySQL"})," (5.7+)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"MariaDB"})," (10.3+)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Microsoft SQL Server"})," (2016+)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Oracle Database"})," (12c+)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SQLite"})," (3.x)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuraci\xf3n-de-conexi\xf3n",children:"Configuraci\xf3n de Conexi\xf3n"}),"\n",(0,s.jsx)(n.h3,{id:"configuraci\xf3n-b\xe1sica",children:"Configuraci\xf3n B\xe1sica"}),"\n",(0,s.jsx)(n.p,{children:"Para configurar una conexi\xf3n a una base de datos SQL, debes definir los par\xe1metros en tu archivo de configuraci\xf3n:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// config/datasources.js\r\nmodule.exports = {\r\n  datasources: {\r\n    postgres: {\r\n      type: 'postgres',\r\n      host: 'localhost',\r\n      port: 5432,\r\n      database: 'mi_base_de_datos',\r\n      username: 'usuario',\r\n      password: 'contrase\xf1a',\r\n      ssl: false\r\n    },\r\n    mysql: {\r\n      type: 'mysql',\r\n      host: 'localhost',\r\n      port: 3306,\r\n      database: 'mi_base_de_datos',\r\n      username: 'usuario',\r\n      password: 'contrase\xf1a'\r\n    },\r\n    sqlserver: {\r\n      type: 'mssql',\r\n      host: 'localhost',\r\n      port: 1433,\r\n      database: 'mi_base_de_datos',\r\n      username: 'usuario',\r\n      password: 'contrase\xf1a',\r\n      options: {\r\n        encrypt: true\r\n      }\r\n    },\r\n    sqlite: {\r\n      type: 'sqlite',\r\n      database: './data/database.sqlite',\r\n      synchronize: true\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"opciones-avanzadas",children:"Opciones Avanzadas"}),"\n",(0,s.jsx)(n.p,{children:"Cada tipo de base de datos admite opciones espec\xedficas para optimizar el rendimiento y la seguridad:"}),"\n",(0,s.jsx)(n.h4,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"postgres: {\r\n  type: 'postgres',\r\n  host: 'localhost',\r\n  port: 5432,\r\n  database: 'mi_base_de_datos',\r\n  username: 'usuario',\r\n  password: 'contrase\xf1a',\r\n  schema: 'public',\r\n  ssl: {\r\n    rejectUnauthorized: false,\r\n    ca: fs.readFileSync('/ruta/al/certificado.crt').toString()\r\n  },\r\n  poolSize: 10,\r\n  idleTimeoutMillis: 30000,\r\n  connectionTimeoutMillis: 2000\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"mysqlmariadb",children:"MySQL/MariaDB"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"mysql: {\r\n  type: 'mysql',\r\n  host: 'localhost',\r\n  port: 3306,\r\n  database: 'mi_base_de_datos',\r\n  username: 'usuario',\r\n  password: 'contrase\xf1a',\r\n  charset: 'utf8mb4',\r\n  timezone: '+00:00',\r\n  connectionLimit: 10,\r\n  acquireTimeout: 10000,\r\n  waitForConnections: true,\r\n  queueLimit: 0\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"sql-server",children:"SQL Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"sqlserver: {\r\n  type: 'mssql',\r\n  host: 'localhost',\r\n  port: 1433,\r\n  database: 'mi_base_de_datos',\r\n  username: 'usuario',\r\n  password: 'contrase\xf1a',\r\n  options: {\r\n    encrypt: true,\r\n    trustServerCertificate: true,\r\n    enableArithAbort: true\r\n  },\r\n  pool: {\r\n    max: 10,\r\n    min: 0,\r\n    idleTimeoutMillis: 30000\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"oracle",children:"Oracle"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"oracle: {\r\n  type: 'oracle',\r\n  host: 'localhost',\r\n  port: 1521,\r\n  sid: 'ORCL',\r\n  username: 'usuario',\r\n  password: 'contrase\xf1a',\r\n  connectString: 'localhost:1521/ORCL',\r\n  poolMax: 10,\r\n  poolMin: 2,\r\n  poolIncrement: 1,\r\n  poolTimeout: 60\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"conexi\xf3n-mediante-url",children:"Conexi\xf3n mediante URL"}),"\n",(0,s.jsx)(n.p,{children:"Tambi\xe9n puedes configurar la conexi\xf3n utilizando una URL de conexi\xf3n:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"postgres: {\r\n  type: 'postgres',\r\n  url: 'postgresql://usuario:contrase\xf1a@localhost:5432/mi_base_de_datos'\r\n},\r\nmysql: {\r\n  type: 'mysql',\r\n  url: 'mysql://usuario:contrase\xf1a@localhost:3306/mi_base_de_datos'\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"variables-de-entorno",children:"Variables de Entorno"}),"\n",(0,s.jsx)(n.p,{children:"Para mayor seguridad, es recomendable utilizar variables de entorno para las credenciales:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"postgres: {\r\n  type: 'postgres',\r\n  host: process.env.DB_HOST,\r\n  port: parseInt(process.env.DB_PORT || '5432'),\r\n  database: process.env.DB_NAME,\r\n  username: process.env.DB_USER,\r\n  password: process.env.DB_PASSWORD,\r\n  ssl: process.env.DB_SSL === 'true'\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuraci\xf3n-de-modelos",children:"Configuraci\xf3n de Modelos"}),"\n",(0,s.jsx)(n.h3,{id:"mapeo-de-tablas",children:"Mapeo de Tablas"}),"\n",(0,s.jsx)(n.p,{children:"Puedes mapear tus modelos a tablas existentes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// models/Usuario.js\r\nmodule.exports = {\r\n  name: 'Usuario',\r\n  datasource: 'postgres',\r\n  tableName: 'usuarios', // Nombre de la tabla en la base de datos\r\n  columns: {\r\n    id: {\r\n      type: 'integer',\r\n      primaryKey: true,\r\n      autoIncrement: true,\r\n      columnName: 'usuario_id' // Nombre de la columna en la tabla\r\n    },\r\n    nombre: {\r\n      type: 'string',\r\n      length: 100,\r\n      columnName: 'nombre_completo'\r\n    },\r\n    email: {\r\n      type: 'string',\r\n      unique: true\r\n    },\r\n    fechaRegistro: {\r\n      type: 'datetime',\r\n      columnName: 'fecha_registro',\r\n      defaultValue: () => new Date()\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\xedndices",children:"\xcdndices"}),"\n",(0,s.jsx)(n.p,{children:"Puedes definir \xedndices para optimizar las consultas:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// models/Producto.js\r\nmodule.exports = {\r\n  name: 'Producto',\r\n  datasource: 'mysql',\r\n  tableName: 'productos',\r\n  columns: {\r\n    // Definici\xf3n de columnas...\r\n  },\r\n  indexes: [\r\n    {\r\n      name: 'idx_producto_nombre',\r\n      columns: ['nombre']\r\n    },\r\n    {\r\n      name: 'idx_producto_categoria_precio',\r\n      columns: ['categoriaId', 'precio']\r\n    },\r\n    {\r\n      name: 'idx_producto_sku',\r\n      columns: ['sku'],\r\n      unique: true\r\n    }\r\n  ]\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"relaciones",children:"Relaciones"}),"\n",(0,s.jsx)(n.p,{children:"Define relaciones entre tus modelos:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// models/Pedido.js\r\nmodule.exports = {\r\n  name: 'Pedido',\r\n  datasource: 'postgres',\r\n  tableName: 'pedidos',\r\n  columns: {\r\n    // Definici\xf3n de columnas...\r\n    clienteId: {\r\n      type: 'integer',\r\n      columnName: 'cliente_id'\r\n    }\r\n  },\r\n  relations: {\r\n    cliente: {\r\n      type: 'belongsTo',\r\n      target: 'Cliente',\r\n      foreignKey: 'clienteId',\r\n      targetKey: 'id'\r\n    },\r\n    items: {\r\n      type: 'hasMany',\r\n      target: 'PedidoItem',\r\n      foreignKey: 'pedidoId',\r\n      cascade: true\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"sincronizaci\xf3n-de-esquema",children:"Sincronizaci\xf3n de Esquema"}),"\n",(0,s.jsx)(n.p,{children:"NexusData puede sincronizar autom\xe1ticamente tus modelos con la base de datos:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// config/datasources.js\r\nmodule.exports = {\r\n  datasources: {\r\n    postgres: {\r\n      // Configuraci\xf3n b\xe1sica...\r\n      synchronize: true, // Sincroniza autom\xe1ticamente el esquema\r\n      dropSchema: false, // No elimina el esquema existente\r\n      migrationsRun: true, // Ejecuta migraciones pendientes\r\n      logging: true // Muestra consultas SQL en la consola\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"opciones-de-sincronizaci\xf3n",children:"Opciones de Sincronizaci\xf3n"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"synchronize"}),": Sincroniza el esquema autom\xe1ticamente (no recomendado para producci\xf3n)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"dropSchema"}),": Elimina el esquema existente antes de sincronizar (\xa1usar con precauci\xf3n!)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"migrationsRun"}),": Ejecuta migraciones pendientes al iniciar"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"logging"}),": Muestra consultas SQL en la consola"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"migraciones",children:"Migraciones"}),"\n",(0,s.jsx)(n.p,{children:"Para entornos de producci\xf3n, es recomendable utilizar migraciones en lugar de sincronizaci\xf3n autom\xe1tica:"}),"\n",(0,s.jsx)(n.h3,{id:"crear-una-migraci\xf3n",children:"Crear una Migraci\xf3n"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nexusdata migration:create --name=crear-tabla-usuarios\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Esto generar\xe1 un archivo de migraci\xf3n en ",(0,s.jsx)(n.code,{children:"migrations/TIMESTAMP-crear-tabla-usuarios.js"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// migrations/20230615123456-crear-tabla-usuarios.js\r\nmodule.exports = {\r\n  async up(queryRunner) {\r\n    await queryRunner.query(`\r\n      CREATE TABLE usuarios (\r\n        id SERIAL PRIMARY KEY,\r\n        nombre VARCHAR(100) NOT NULL,\r\n        email VARCHAR(255) UNIQUE NOT NULL,\r\n        password VARCHAR(255) NOT NULL,\r\n        fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n      )\r\n    `);\r\n    \r\n    await queryRunner.query(`\r\n      CREATE INDEX idx_usuarios_email ON usuarios(email)\r\n    `);\r\n  },\r\n  \r\n  async down(queryRunner) {\r\n    await queryRunner.query(`DROP TABLE IF EXISTS usuarios`);\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ejecutar-migraciones",children:"Ejecutar Migraciones"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Ejecutar todas las migraciones pendientes\r\nnexusdata migration:run\r\n\r\n# Revertir la \xfaltima migraci\xf3n\r\nnexusdata migration:revert\r\n\r\n# Mostrar migraciones pendientes\r\nnexusdata migration:show\n"})}),"\n",(0,s.jsx)(n.h2,{id:"consultas-personalizadas",children:"Consultas Personalizadas"}),"\n",(0,s.jsx)(n.h3,{id:"consultas-sql-directas",children:"Consultas SQL Directas"}),"\n",(0,s.jsx)(n.p,{children:"Puedes ejecutar consultas SQL directamente:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// services/ReporteService.js\r\nmodule.exports = {\r\n  async generarReporteVentas(fechaInicio, fechaFin) {\r\n    const datasource = this.app.datasources.postgres;\r\n    \r\n    const result = await datasource.query(`\r\n      SELECT \r\n        p.categoria_id,\r\n        c.nombre AS categoria,\r\n        SUM(pi.cantidad) AS unidades_vendidas,\r\n        SUM(pi.cantidad * pi.precio) AS total_ventas\r\n      FROM pedidos p\r\n      JOIN pedido_items pi ON p.id = pi.pedido_id\r\n      JOIN productos pr ON pi.producto_id = pr.id\r\n      JOIN categorias c ON pr.categoria_id = c.id\r\n      WHERE p.fecha BETWEEN $1 AND $2\r\n      GROUP BY p.categoria_id, c.nombre\r\n      ORDER BY total_ventas DESC\r\n    `, [fechaInicio, fechaFin]);\r\n    \r\n    return result;\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"consultas-con-querybuilder",children:"Consultas con QueryBuilder"}),"\n",(0,s.jsx)(n.p,{children:"NexusData proporciona un constructor de consultas para crear consultas complejas de forma program\xe1tica:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// services/ProductoService.js\r\nmodule.exports = {\r\n  async buscarProductos(filtros) {\r\n    const { categoriaId, precioMin, precioMax, termino, ordenar, pagina, porPagina } = filtros;\r\n    \r\n    const queryBuilder = this.app.models.Producto.createQueryBuilder('p')\r\n      .leftJoin('p.categoria', 'c')\r\n      .select(['p.*', 'c.nombre AS categoria_nombre']);\r\n    \r\n    if (categoriaId) {\r\n      queryBuilder.where('p.categoria_id = :categoriaId', { categoriaId });\r\n    }\r\n    \r\n    if (precioMin) {\r\n      queryBuilder.andWhere('p.precio >= :precioMin', { precioMin });\r\n    }\r\n    \r\n    if (precioMax) {\r\n      queryBuilder.andWhere('p.precio <= :precioMax', { precioMax });\r\n    }\r\n    \r\n    if (termino) {\r\n      queryBuilder.andWhere('(p.nombre LIKE :termino OR p.descripcion LIKE :termino)', \r\n        { termino: `%${termino}%` });\r\n    }\r\n    \r\n    // Ordenamiento\r\n    if (ordenar) {\r\n      const [campo, direccion] = ordenar.split(':');\r\n      queryBuilder.orderBy(`p.${campo}`, direccion || 'ASC');\r\n    } else {\r\n      queryBuilder.orderBy('p.nombre', 'ASC');\r\n    }\r\n    \r\n    // Paginaci\xf3n\r\n    const limit = porPagina || 20;\r\n    const offset = ((pagina || 1) - 1) * limit;\r\n    \r\n    queryBuilder.limit(limit).offset(offset);\r\n    \r\n    // Ejecutar consulta\r\n    const [items, total] = await Promise.all([\r\n      queryBuilder.getMany(),\r\n      queryBuilder.clone().count('p.id as total').getRawOne()\r\n    ]);\r\n    \r\n    return {\r\n      items,\r\n      total: parseInt(total.total),\r\n      pagina: pagina || 1,\r\n      porPagina: limit,\r\n      totalPaginas: Math.ceil(parseInt(total.total) / limit)\r\n    };\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"transacciones",children:"Transacciones"}),"\n",(0,s.jsx)(n.p,{children:"Las transacciones garantizan la integridad de los datos:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// services/PedidoService.js\r\nmodule.exports = {\r\n  async crearPedido(datos) {\r\n    const datasource = this.app.datasources.postgres;\r\n    \r\n    // Iniciar transacci\xf3n\r\n    return await datasource.transaction(async (transactionManager) => {\r\n      // Crear pedido\r\n      const pedido = await transactionManager.create('Pedido', {\r\n        clienteId: datos.clienteId,\r\n        fecha: new Date(),\r\n        estado: 'pendiente',\r\n        total: 0\r\n      });\r\n      \r\n      let totalPedido = 0;\r\n      \r\n      // Crear items del pedido\r\n      for (const item of datos.items) {\r\n        // Verificar stock\r\n        const producto = await transactionManager.findOne('Producto', {\r\n          where: { id: item.productoId }\r\n        });\r\n        \r\n        if (!producto) {\r\n          throw new Error(`Producto no encontrado: ${item.productoId}`);\r\n        }\r\n        \r\n        if (producto.stock < item.cantidad) {\r\n          throw new Error(`Stock insuficiente para ${producto.nombre}`);\r\n        }\r\n        \r\n        // Crear item\r\n        await transactionManager.create('PedidoItem', {\r\n          pedidoId: pedido.id,\r\n          productoId: item.productoId,\r\n          cantidad: item.cantidad,\r\n          precio: producto.precio,\r\n          subtotal: producto.precio * item.cantidad\r\n        });\r\n        \r\n        // Actualizar stock\r\n        await transactionManager.update('Producto', {\r\n          id: producto.id,\r\n          stock: producto.stock - item.cantidad\r\n        });\r\n        \r\n        totalPedido += producto.precio * item.cantidad;\r\n      }\r\n      \r\n      // Actualizar total del pedido\r\n      await transactionManager.update('Pedido', {\r\n        id: pedido.id,\r\n        total: totalPedido\r\n      });\r\n      \r\n      // Registrar historial\r\n      await transactionManager.create('PedidoHistorial', {\r\n        pedidoId: pedido.id,\r\n        estado: 'pendiente',\r\n        fecha: new Date(),\r\n        comentario: 'Pedido creado'\r\n      });\r\n      \r\n      // Obtener pedido completo con relaciones\r\n      return await transactionManager.findOne('Pedido', {\r\n        where: { id: pedido.id },\r\n        include: ['cliente', 'items', 'items.producto']\r\n      });\r\n    });\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"procedimientos-almacenados-y-funciones",children:"Procedimientos Almacenados y Funciones"}),"\n",(0,s.jsx)(n.p,{children:"Puedes utilizar procedimientos almacenados y funciones de la base de datos:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// services/InventarioService.js\r\nmodule.exports = {\r\n  async actualizarInventario(productoId, cantidad, tipo) {\r\n    const datasource = this.app.datasources.postgres;\r\n    \r\n    // Llamar a un procedimiento almacenado\r\n    return await datasource.query(\r\n      'CALL actualizar_inventario($1, $2, $3)',\r\n      [productoId, cantidad, tipo]\r\n    );\r\n  },\r\n  \r\n  async calcularValorInventario() {\r\n    const datasource = this.app.datasources.postgres;\r\n    \r\n    // Llamar a una funci\xf3n\r\n    const result = await datasource.query(\r\n      'SELECT calcular_valor_inventario() AS valor'\r\n    );\r\n    \r\n    return result[0].valor;\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"optimizaci\xf3n-de-rendimiento",children:"Optimizaci\xf3n de Rendimiento"}),"\n",(0,s.jsx)(n.h3,{id:"configuraci\xf3n-de-pool-de-conexiones",children:"Configuraci\xf3n de Pool de Conexiones"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"postgres: {\r\n  type: 'postgres',\r\n  // Configuraci\xf3n b\xe1sica...\r\n  poolSize: 20, // N\xfamero m\xe1ximo de conexiones\r\n  idleTimeoutMillis: 30000, // Tiempo m\xe1ximo de inactividad (ms)\r\n  connectionTimeoutMillis: 2000 // Tiempo m\xe1ximo para establecer conexi\xf3n (ms)\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"consultas-optimizadas",children:"Consultas Optimizadas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Selecciona solo las columnas necesarias"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const usuarios = await this.app.models.Usuario.find({\r\n  select: ['id', 'nombre', 'email'],\r\n  where: { activo: true }\r\n});\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Utiliza \xedndices adecuados"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// models/Producto.js\r\nmodule.exports = {\r\n  // ...\r\n  indexes: [\r\n    {\r\n      name: 'idx_producto_busqueda',\r\n      columns: ['nombre', 'sku', 'categoriaId'],\r\n      type: 'FULLTEXT' // Para MySQL\r\n    }\r\n  ]\r\n};\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Paginaci\xf3n eficiente"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const { items, total } = await this.app.models.Producto.findAndCount({\r\n  where: { categoriaId: 5 },\r\n  order: { createdAt: 'DESC' },\r\n  skip: (pagina - 1) * porPagina,\r\n  take: porPagina\r\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"monitoreo-y-diagn\xf3stico",children:"Monitoreo y Diagn\xf3stico"}),"\n",(0,s.jsx)(n.h3,{id:"logging-de-consultas",children:"Logging de Consultas"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"postgres: {\r\n  type: 'postgres',\r\n  // Configuraci\xf3n b\xe1sica...\r\n  logging: true, // Habilita el logging de todas las consultas\r\n  maxQueryExecutionTime: 1000 // Registra consultas que tarden m\xe1s de 1000ms\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"estad\xedsticas-de-conexi\xf3n",children:"Estad\xedsticas de Conexi\xf3n"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// services/AdminService.js\r\nmodule.exports = {\r\n  async obtenerEstadisticasDB() {\r\n    const datasource = this.app.datasources.postgres;\r\n    \r\n    // Obtener estad\xedsticas del pool de conexiones\r\n    const stats = await datasource.getPoolStats();\r\n    \r\n    return {\r\n      total: stats.total,\r\n      idle: stats.idle,\r\n      used: stats.used,\r\n      waiting: stats.waiting,\r\n      maxConnections: datasource.options.poolSize\r\n    };\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"mejores-pr\xe1cticas",children:"Mejores Pr\xe1cticas"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Seguridad"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Nunca almacenes credenciales en el c\xf3digo fuente"}),"\n",(0,s.jsx)(n.li,{children:"Utiliza variables de entorno o servicios de gesti\xf3n de secretos"}),"\n",(0,s.jsx)(n.li,{children:"Implementa par\xe1metros preparados para evitar inyecci\xf3n SQL"}),"\n",(0,s.jsx)(n.li,{children:"Limita los permisos del usuario de base de datos"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rendimiento"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Utiliza \xedndices adecuados para consultas frecuentes"}),"\n",(0,s.jsx)(n.li,{children:"Implementa paginaci\xf3n para conjuntos de datos grandes"}),"\n",(0,s.jsx)(n.li,{children:"Optimiza consultas complejas con EXPLAIN"}),"\n",(0,s.jsx)(n.li,{children:"Configura adecuadamente el pool de conexiones"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Mantenimiento"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Utiliza migraciones para cambios en el esquema"}),"\n",(0,s.jsx)(n.li,{children:"Implementa respaldos regulares"}),"\n",(0,s.jsx)(n.li,{children:"Monitorea el rendimiento de la base de datos"}),"\n",(0,s.jsx)(n.li,{children:"Mant\xe9n actualizado el sistema de gesti\xf3n de base de datos"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Desarrollo"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Utiliza entornos separados para desarrollo, pruebas y producci\xf3n"}),"\n",(0,s.jsx)(n.li,{children:"Implementa pruebas automatizadas para la capa de datos"}),"\n",(0,s.jsx)(n.li,{children:"Documenta el esquema y las relaciones"}),"\n",(0,s.jsx)(n.li,{children:"Utiliza herramientas de an\xe1lisis est\xe1tico para SQL"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"soluci\xf3n-de-problemas-comunes",children:"Soluci\xf3n de Problemas Comunes"}),"\n",(0,s.jsx)(n.h3,{id:"problemas-de-conexi\xf3n",children:"Problemas de Conexi\xf3n"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Verificar conexi\xf3n\r\nasync function verificarConexion() {\r\n  try {\r\n    await app.datasources.postgres.query('SELECT 1');\r\n    console.log('Conexi\xf3n exitosa');\r\n  } catch (error) {\r\n    console.error('Error de conexi\xf3n:', error.message);\r\n    \r\n    // Verificar problemas comunes\r\n    if (error.code === 'ECONNREFUSED') {\r\n      console.error('El servidor de base de datos no est\xe1 disponible');\r\n    } else if (error.code === 'ETIMEDOUT') {\r\n      console.error('Tiempo de espera agotado al conectar');\r\n    } else if (error.code === '28P01') {\r\n      console.error('Credenciales incorrectas');\r\n    } else if (error.code === '3D000') {\r\n      console.error('Base de datos no existe');\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"problemas-de-rendimiento",children:"Problemas de Rendimiento"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Analizar consulta lenta\r\nasync function analizarConsulta(consulta, parametros) {\r\n  try {\r\n    const resultado = await app.datasources.postgres.query(\r\n      `EXPLAIN ANALYZE ${consulta}`,\r\n      parametros\r\n    );\r\n    console.log('Plan de ejecuci\xf3n:', resultado);\r\n  } catch (error) {\r\n    console.error('Error al analizar consulta:', error.message);\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"conclusi\xf3n",children:"Conclusi\xf3n"}),"\n",(0,s.jsx)(n.p,{children:"Las fuentes de datos SQL en NexusData proporcionan una forma potente y flexible de trabajar con bases de datos relacionales. Con soporte para m\xfaltiples sistemas de gesti\xf3n de bases de datos, caracter\xedsticas avanzadas como transacciones y migraciones, y herramientas para optimizar el rendimiento, NexusData te permite aprovechar al m\xe1ximo tus datos relacionales."}),"\n",(0,s.jsxs)(n.p,{children:["Para casos de uso m\xe1s avanzados, consulta la ",(0,s.jsx)(n.a,{href:"/docs/reference",children:"Referencia de API"})," y la documentaci\xf3n espec\xedfica de cada sistema de gesti\xf3n de base de datos."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\r\nEste archivo proporciona una documentaci\xf3n completa sobre c\xf3mo configurar y utilizar fuentes de datos SQL en NexusData, incluyendo configuraci\xf3n de conexi\xf3n, mapeo de modelos, migraciones, consultas personalizadas, transacciones y optimizaci\xf3n de rendimiento.\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>t});var a=r(6540);const s={},i=a.createContext(s);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);