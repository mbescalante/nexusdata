"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5748],{7828:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"auth/jwt","title":"JWT","description":"JSON Web Tokens (JWT) es el m\xe9todo de autenticaci\xf3n recomendado para aplicaciones modernas en NexusData. Este enfoque sin estado permite una escalabilidad sencilla y es ideal para arquitecturas de microservicios.","source":"@site/docs/auth/jwt.md","sourceDirName":"auth","slug":"/auth/jwt","permalink":"/nexusdata/en/docs/auth/jwt","draft":false,"unlisted":false,"editUrl":"https://github.com/mbescalante/nexusdata/edit/main/docs/auth/jwt.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Autenticaci\xf3n y Autorizaci\xf3n","permalink":"/nexusdata/en/docs/auth/"},"next":{"title":"OAuth","permalink":"/nexusdata/en/docs/auth/oauth"}}');var s=r(4848),o=r(8453);const i={sidebar_position:1},t="JWT",c={},l=[{value:"Configuraci\xf3n b\xe1sica",id:"configuraci\xf3n-b\xe1sica",level:2},{value:"Estructura del token",id:"estructura-del-token",level:2},{value:"Flujo de autenticaci\xf3n",id:"flujo-de-autenticaci\xf3n",level:2},{value:"Implementaci\xf3n del login",id:"implementaci\xf3n-del-login",level:2},{value:"Renovaci\xf3n de tokens",id:"renovaci\xf3n-de-tokens",level:2},{value:"Seguridad de los tokens",id:"seguridad-de-los-tokens",level:2},{value:"Revocaci\xf3n de tokens",id:"revocaci\xf3n-de-tokens",level:2},{value:"Uso en clientes",id:"uso-en-clientes",level:2},{value:"React",id:"react",level:3},{value:"Pr\xf3ximos pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"jwt",children:"JWT"})}),"\n",(0,s.jsx)(n.p,{children:"JSON Web Tokens (JWT) es el m\xe9todo de autenticaci\xf3n recomendado para aplicaciones modernas en NexusData. Este enfoque sin estado permite una escalabilidad sencilla y es ideal para arquitecturas de microservicios."}),"\n",(0,s.jsx)(n.h2,{id:"configuraci\xf3n-b\xe1sica",children:"Configuraci\xf3n b\xe1sica"}),"\n",(0,s.jsx)(n.p,{children:"Para habilitar la autenticaci\xf3n JWT en tu aplicaci\xf3n NexusData:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// nexusdata.config.js\r\nmodule.exports = {\r\n  // ... otras configuraciones\r\n  auth: {\r\n    jwt: {\r\n      secret: process.env.JWT_SECRET,\r\n      expiresIn: '1d', // 1 d\xeda\r\n      refreshToken: {\r\n        enabled: true,\r\n        expiresIn: '7d', // 7 d\xedas\r\n      }\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"estructura-del-token",children:"Estructura del token"}),"\n",(0,s.jsx)(n.p,{children:"Los tokens JWT generados por NexusData contienen la siguiente informaci\xf3n:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "sub": "1234567890", // ID del usuario\r\n  "name": "John Doe",\r\n  "role": "ADMIN",\r\n  "permissions": ["article:create", "article:read"],\r\n  "iat": 1516239022, // Fecha de emisi\xf3n\r\n  "exp": 1516325422  // Fecha de expiraci\xf3n\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"flujo-de-autenticaci\xf3n",children:"Flujo de autenticaci\xf3n"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Registro/Login : El usuario proporciona credenciales y recibe un token JWT y un refresh token"}),"\n",(0,s.jsx)(n.li,{children:"Solicitudes autenticadas : El cliente incluye el token JWT en el header Authorization"}),"\n",(0,s.jsx)(n.li,{children:"Verificaci\xf3n : NexusData verifica autom\xe1ticamente el token en cada solicitud"}),"\n",(0,s.jsx)(n.li,{children:"Renovaci\xf3n : Cuando el token expira, el cliente usa el refresh token para obtener un nuevo JWT"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"implementaci\xf3n-del-login",children:"Implementaci\xf3n del login"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// src/resolvers/auth/login.js\r\nmodule.exports = {\r\n  name: 'login',\r\n  type: 'AuthPayload',\r\n  args: {\r\n    email: 'String!',\r\n    password: 'String!'\r\n  },\r\n  resolve: async (parent, args, context) => {\r\n    const { email, password } = args;\r\n    const { services, models } = context;\r\n    \r\n    // Buscar usuario\r\n    const user = await models.User.findUnique({\r\n      where: { email }\r\n    });\r\n    \r\n    if (!user || !user.isActive) {\r\n      throw new Error('Credenciales inv\xe1lidas');\r\n    }\r\n    \r\n    // Verificar contrase\xf1a\r\n    const passwordValid = await services.auth.verifyPassword(\r\n      password, \r\n      user.password\r\n    );\r\n    \r\n    if (!passwordValid) {\r\n      throw new Error('Credenciales inv\xe1lidas');\r\n    }\r\n    \r\n    // Generar token JWT\r\n    const token = await services.auth.generateToken({\r\n      userId: user.id,\r\n      role: user.role\r\n    });\r\n    \r\n    // Generar refresh token\r\n    const refreshToken = await services.auth.generateRefreshToken(user.id);\r\n    \r\n    return {\r\n      token,\r\n      refreshToken,\r\n      user: {\r\n        id: user.id,\r\n        email: user.email,\r\n        firstName: user.firstName,\r\n        lastName: user.lastName,\r\n        role: user.role\r\n      }\r\n    };\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"renovaci\xf3n-de-tokens",children:"Renovaci\xf3n de tokens"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// src/resolvers/auth/refreshToken.js\r\nmodule.exports = {\r\n  name: 'refreshToken',\r\n  type: 'RefreshTokenPayload',\r\n  args: {\r\n    refreshToken: 'String!'\r\n  },\r\n  resolve: async (parent, args, context) => {\r\n    const { refreshToken } = args;\r\n    const { services } = context;\r\n    \r\n    // Verificar refresh token\r\n    const payload = await services.auth.verifyRefreshToken(refreshToken);\r\n    \r\n    if (!payload || !payload.userId) {\r\n      throw new Error('Token inv\xe1lido o expirado');\r\n    }\r\n    \r\n    // Generar nuevo token JWT\r\n    const newToken = await services.auth.generateToken({\r\n      userId: payload.userId,\r\n      role: payload.role\r\n    });\r\n    \r\n    // Generar nuevo refresh token\r\n    const newRefreshToken = await services.auth.generateRefreshToken(payload.userId);\r\n    \r\n    return {\r\n      token: newToken,\r\n      refreshToken: newRefreshToken\r\n    };\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"seguridad-de-los-tokens",children:"Seguridad de los tokens"}),"\n",(0,s.jsx)(n.p,{children:"Para garantizar la seguridad de tus tokens JWT:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Usa un secreto fuerte : Genera un secreto aleatorio y seguro"}),"\n",(0,s.jsx)(n.li,{children:"Configura tiempos de expiraci\xf3n cortos : Recomendamos entre 15 minutos y 1 d\xeda"}),"\n",(0,s.jsx)(n.li,{children:"Implementa rotaci\xf3n de secretos : Cambia peri\xf3dicamente el secreto"}),"\n",(0,s.jsx)(n.li,{children:"Usa HTTPS : Siempre transmite tokens a trav\xe9s de conexiones seguras"}),"\n",(0,s.jsx)(n.li,{children:"Almacenamiento seguro : Guarda los tokens en localStorage o cookies HttpOnly"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"revocaci\xf3n-de-tokens",children:"Revocaci\xf3n de tokens"}),"\n",(0,s.jsx)(n.p,{children:"Aunque los JWT son sin estado, NexusData proporciona un mecanismo de revocaci\xf3n:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Revocar token para un usuario espec\xedfico\r\nawait services.auth.revokeTokens(userId);\r\n\r\n// Revocar todos los tokens (\xfatil en caso de compromiso)\r\nawait services.auth.revokeAllTokens();\n"})}),"\n",(0,s.jsx)(n.h2,{id:"uso-en-clientes",children:"Uso en clientes"}),"\n",(0,s.jsx)(n.h3,{id:"react",children:"React"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"// Ejemplo de uso en React con axios\r\nimport axios from 'axios';\r\n\r\n// Configurar interceptor para incluir token\r\naxios.interceptors.request.use(config => {\r\n  const token = localStorage.getItem('token');\r\n  if (token) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  return config;\r\n});\r\n\r\n// Funci\xf3n de login\r\nconst login = async (email, password) => {\r\n  try {\r\n    const response = await axios.post('/api/auth/login', {\r\n      email,\r\n      password\r\n    });\r\n    \r\n    const { token, refreshToken, user } = response.data;\r\n    \r\n    // Guardar tokens\r\n    localStorage.setItem('token', token);\r\n    localStorage.setItem('refreshToken', refreshToken);\r\n    \r\n    return user;\r\n  } catch (error) {\r\n    console.error('Error de login:', error);\r\n    throw error;\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos pasos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Implementa autenticaci\xf3n multi-factor para mayor seguridad"}),"\n",(0,s.jsx)(n.li,{children:"Configura pol\xedticas de acceso basadas en roles"}),"\n",(0,s.jsx)(n.li,{children:"Explora la integraci\xf3n con OAuth para login social"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>t});var a=r(6540);const s={},o=a.createContext(s);function i(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);