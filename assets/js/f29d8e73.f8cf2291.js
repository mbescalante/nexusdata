"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1063],{124:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"auth/oauth","title":"OAuth","description":"NexusData proporciona integraci\xf3n completa con proveedores OAuth 2.0, permitiendo a los usuarios iniciar sesi\xf3n con sus cuentas existentes de Google, GitHub, Facebook y otros servicios populares.","source":"@site/docs/auth/oauth.md","sourceDirName":"auth","slug":"/auth/oauth","permalink":"/docs/auth/oauth","draft":false,"unlisted":false,"editUrl":"https://github.com/nexusdata/nexusdata-docs/edit/main/docs/auth/oauth.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"JWT","permalink":"/docs/auth/jwt"},"next":{"title":"Roles y Permisos","permalink":"/docs/auth/roles-permisos"}}');var i=r(4848),a=r(8453);const s={sidebar_position:2},t="OAuth",l={},c=[{value:"Configuraci\xf3n de proveedores",id:"configuraci\xf3n-de-proveedores",level:2},{value:"Flujo de autenticaci\xf3n OAuth",id:"flujo-de-autenticaci\xf3n-oauth",level:2},{value:"Endpoints generados",id:"endpoints-generados",level:2},{value:"Personalizaci\xf3n del proceso",id:"personalizaci\xf3n-del-proceso",level:2},{value:"Implementaci\xf3n en el frontend",id:"implementaci\xf3n-en-el-frontend",level:2},{value:"Botones de login social",id:"botones-de-login-social",level:3},{value:"Modelo de datos para OAuth",id:"modelo-de-datos-para-oauth",level:2},{value:"Consideraciones de seguridad",id:"consideraciones-de-seguridad",level:2},{value:"Proveedores soportados",id:"proveedores-soportados",level:2},{value:"Pr\xf3ximos pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"oauth",children:"OAuth"})}),"\n",(0,i.jsx)(n.p,{children:"NexusData proporciona integraci\xf3n completa con proveedores OAuth 2.0, permitiendo a los usuarios iniciar sesi\xf3n con sus cuentas existentes de Google, GitHub, Facebook y otros servicios populares."}),"\n",(0,i.jsx)(n.h2,{id:"configuraci\xf3n-de-proveedores",children:"Configuraci\xf3n de proveedores"}),"\n",(0,i.jsx)(n.p,{children:"Para habilitar la autenticaci\xf3n OAuth en tu aplicaci\xf3n NexusData:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// nexusdata.config.js\r\nmodule.exports = {\r\n  // ... otras configuraciones\r\n  auth: {\r\n    oauth: {\r\n      providers: {\r\n        google: {\r\n          clientId: process.env.GOOGLE_CLIENT_ID,\r\n          clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n          callbackURL: '/auth/google/callback',\r\n          scope: ['profile', 'email']\r\n        },\r\n        github: {\r\n          clientId: process.env.GITHUB_CLIENT_ID,\r\n          clientSecret: process.env.GITHUB_CLIENT_SECRET,\r\n          callbackURL: '/auth/github/callback',\r\n          scope: ['user:email']\r\n        },\r\n        facebook: {\r\n          clientId: process.env.FACEBOOK_CLIENT_ID,\r\n          clientSecret: process.env.FACEBOOK_CLIENT_SECRET,\r\n          callbackURL: '/auth/facebook/callback',\r\n          scope: ['email', 'public_profile']\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"flujo-de-autenticaci\xf3n-oauth",children:"Flujo de autenticaci\xf3n OAuth"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Redirecci\xf3n al proveedor"}),' : El usuario hace clic en "Iniciar sesi\xf3n con X" y es redirigido al proveedor']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Autorizaci\xf3n"})," : El usuario autoriza tu aplicaci\xf3n en el sitio del proveedor"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Callback"})," : El proveedor redirige de vuelta a tu aplicaci\xf3n con un c\xf3digo de autorizaci\xf3n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Intercambio de tokens"})," : Tu aplicaci\xf3n intercambia el c\xf3digo por un token de acceso"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Obtenci\xf3n de perfil"})," : Se obtiene la informaci\xf3n del perfil del usuario"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Creaci\xf3n/actualizaci\xf3n de usuario"})," : Se crea o actualiza el usuario en tu base de datos"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Generaci\xf3n de JWT"})," : Se genera un JWT para la sesi\xf3n del usuario"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"endpoints-generados",children:"Endpoints generados"}),"\n",(0,i.jsx)(n.p,{children:"NexusData genera autom\xe1ticamente los siguientes endpoints para cada proveedor configurado:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"/auth/google"})," - Inicia el flujo de autenticaci\xf3n con Google"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"/auth/google/callback"})," - URL de callback para Google"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"/auth/github"})," - Inicia el flujo de autenticaci\xf3n con GitHub"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"/auth/github/callback"})," - URL de callback para GitHub"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"/auth/facebook"})," - Inicia el flujo de autenticaci\xf3n con Facebook"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"/auth/facebook/callback"})," - URL de callback para Facebook"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"personalizaci\xf3n-del-proceso",children:"Personalizaci\xf3n del proceso"}),"\n",(0,i.jsx)(n.p,{children:"Puedes personalizar el comportamiento durante la autenticaci\xf3n OAuth:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// nexusdata.config.js\r\nmodule.exports = {\r\n  // ... otras configuraciones\r\n  auth: {\r\n    oauth: {\r\n      // ... configuraci\xf3n de proveedores\r\n      \r\n      // Funci\xf3n ejecutada despu\xe9s de obtener el perfil del usuario\r\n      onSuccess: async (profile, provider, context) => {\r\n        const { models, services } = context;\r\n        \r\n        // Buscar usuario existente por email o ID del proveedor\r\n        let user = await models.User.findFirst({\r\n          where: {\r\n            OR: [\r\n              { email: profile.email },\r\n              {\r\n                oauthConnections: {\r\n                  some: {\r\n                    provider,\r\n                    providerId: profile.id\r\n                  }\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          include: {\r\n            oauthConnections: true\r\n          }\r\n        });\r\n        \r\n        if (!user) {\r\n          // Crear nuevo usuario\r\n          user = await models.User.create({\r\n            data: {\r\n              email: profile.email,\r\n              firstName: profile.firstName || profile.given_name,\r\n              lastName: profile.lastName || profile.family_name,\r\n              avatar: profile.picture || profile.avatar_url,\r\n              oauthConnections: {\r\n                create: {\r\n                  provider,\r\n                  providerId: profile.id,\r\n                  data: JSON.stringify(profile)\r\n                }\r\n              }\r\n            }\r\n          });\r\n          \r\n          // Enviar email de bienvenida\r\n          await services.email.send({\r\n            to: user.email,\r\n            subject: 'Bienvenido a nuestra aplicaci\xf3n',\r\n            template: 'welcome-oauth',\r\n            data: { user, provider }\r\n          });\r\n        } else if (!user.oauthConnections.some(conn => conn.provider === provider)) {\r\n          // Conectar cuenta existente con nuevo proveedor\r\n          await models.OAuthConnection.create({\r\n            data: {\r\n              userId: user.id,\r\n              provider,\r\n              providerId: profile.id,\r\n              data: JSON.stringify(profile)\r\n            }\r\n          });\r\n        }\r\n        \r\n        // Generar token JWT\r\n        const token = await services.auth.generateToken({\r\n          userId: user.id,\r\n          role: user.role\r\n        });\r\n        \r\n        // Generar refresh token\r\n        const refreshToken = await services.auth.generateRefreshToken(user.id);\r\n        \r\n        return {\r\n          token,\r\n          refreshToken,\r\n          user\r\n        };\r\n      },\r\n      \r\n      // Funci\xf3n ejecutada en caso de error\r\n      onError: async (error, provider, context) => {\r\n        console.error(`Error de autenticaci\xf3n OAuth con ${provider}:`, error);\r\n        \r\n        // Registrar error\r\n        await context.models.AuthError.create({\r\n          data: {\r\n            provider,\r\n            error: error.message,\r\n            stack: error.stack\r\n          }\r\n        });\r\n        \r\n        // Redirigir a p\xe1gina de error\r\n        return {\r\n          redirect: `/auth/error?provider=${provider}&message=${encodeURIComponent(error.message)}`\r\n        };\r\n      }\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Este c\xf3digo utiliza la funci\xf3n ",(0,i.jsx)(n.code,{children:"onSuccess"})," para manejar el caso de \xe9xito de la autenticaci\xf3n OAuth. En este caso, se crea un nuevo usuario si no existe, se actualiza el usuario existente, se crea una nueva conexi\xf3n de OAuth y se generan tokens JWT y refresh token.\r\nLa funci\xf3n ",(0,i.jsx)(n.code,{children:"onError"})," se utiliza para manejar el caso de error de la autenticaci\xf3n OAuth. En este caso, se registra el error en la base de datos y se redirige al usuario a una p\xe1gina de error."]}),"\n",(0,i.jsx)(n.h2,{id:"implementaci\xf3n-en-el-frontend",children:"Implementaci\xf3n en el frontend"}),"\n",(0,i.jsx)(n.h3,{id:"botones-de-login-social",children:"Botones de login social"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsx",children:"// Componente de botones de login social\r\nimport React from 'react';\r\n\r\nconst SocialLoginButtons = () => {\r\n  return (\r\n    <div className=\"social-buttons\">\r\n      <button \r\n        className=\"social-button google\"\r\n        onClick={() => window.location.href = '/auth/google'}\r\n      >\r\n        <svg>...</svg>\r\n        Continuar con Google\r\n      </button>\r\n      \r\n      <button \r\n        className=\"social-button github\"\r\n        onClick={() => window.location.href = '/auth/github'}\r\n      >\r\n        <svg>...</svg>\r\n        Continuar con GitHub\r\n      </button>\r\n      \r\n      <button \r\n        className=\"social-button facebook\"\r\n        onClick={() => window.location.href = '/auth/facebook'}\r\n      >\r\n        <svg>...</svg>\r\n        Continuar con Facebook\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SocialLoginButtons;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"modelo-de-datos-para-oauth",children:"Modelo de datos para OAuth"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# models.yaml\r\nmodels:\r\n  User:\r\n    fields:\r\n      id:\r\n        type: uuid\r\n        primary: true\r\n      email:\r\n        type: string\r\n        unique: true\r\n      firstName:\r\n        type: string\r\n        nullable: true\r\n      lastName:\r\n        type: string\r\n        nullable: true\r\n      avatar:\r\n        type: string\r\n        nullable: true\r\n      role:\r\n        type: enum\r\n        values: [ADMIN, USER]\r\n        default: USER\r\n    relations:\r\n      oauthConnections:\r\n        type: hasMany\r\n        model: OAuthConnection\r\n        foreignKey: userId\r\n        \r\n  OAuthConnection:\r\n    fields:\r\n      id:\r\n        type: uuid\r\n        primary: true\r\n      provider:\r\n        type: string\r\n      providerId:\r\n        type: string\r\n      data:\r\n        type: json\r\n        nullable: true\r\n      createdAt:\r\n        type: datetime\r\n        default: now()\r\n      updatedAt:\r\n        type: datetime\r\n        default: now()\r\n        onUpdate: now()\r\n    relations:\r\n      user:\r\n        type: belongsTo\r\n        model: User\r\n        foreignKey: userId\r\n    indexes:\r\n      - name: provider_providerId\r\n        fields: [provider, providerId]\r\n        unique: true\r\n      - name: userId_provider\r\n        fields: [userId, provider]\r\n        unique: true\n"})}),"\n",(0,i.jsx)(n.h2,{id:"consideraciones-de-seguridad",children:"Consideraciones de seguridad"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Nunca expongas tus Client Secrets : Almac\xe9nalos en variables de entorno"}),"\n",(0,i.jsx)(n.li,{children:"Valida los emails : Algunos proveedores no verifican emails, considera marcarlos como no verificados"}),"\n",(0,i.jsx)(n.li,{children:"Configura correctamente los dominios : Registra solo dominios que controles en la consola del proveedor"}),"\n",(0,i.jsx)(n.li,{children:"Implementa CSRF protection : Usa el estado OAuth para prevenir ataques CSRF"}),"\n",(0,i.jsx)(n.li,{children:"Limita los permisos : Solicita solo los permisos m\xednimos necesarios"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"proveedores-soportados",children:"Proveedores soportados"}),"\n",(0,i.jsx)(n.p,{children:"NexusData soporta los siguientes proveedores OAuth:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Google"}),"\n",(0,i.jsx)(n.li,{children:"GitHub"}),"\n",(0,i.jsx)(n.li,{children:"Facebook"}),"\n",(0,i.jsx)(n.li,{children:"Twitter"}),"\n",(0,i.jsx)(n.li,{children:"LinkedIn"}),"\n",(0,i.jsx)(n.li,{children:"Microsoft"}),"\n",(0,i.jsx)(n.li,{children:"Apple"}),"\n",(0,i.jsx)(n.li,{children:"Discord"}),"\n",(0,i.jsx)(n.li,{children:"Slack"}),"\n",(0,i.jsx)(n.li,{children:"Spotify"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos pasos"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Configura autenticaci\xf3n multi-factor para mayor seguridad"}),"\n",(0,i.jsx)(n.li,{children:"Implementa JWT personalizado para tus tokens"}),"\n",(0,i.jsx)(n.li,{children:"Explora el control de acceso basado en roles"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>t});var o=r(6540);const i={},a=o.createContext(i);function s(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);